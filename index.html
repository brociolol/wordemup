<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TOP SECRET PROJECT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Josefin+Slab&family=Lilita+One&display=swap" rel="stylesheet">
    <style>
    </style>
  </head>
  <body style="background-color: #EDF2F4">
    <div class="d-flex justify-content-center align-items-center" id="container" style="">
      <main class="d-flex justify-content-center align-items-center flex-column text-center p-2 mt-3" id="main" style="width: 100%; max-width: 900px; height: 90vh;">
        <h1 id="header" class="text-center" style="height: 50px; color: #004F2D; font-family: 'Lilita One', sans-serif;">
        WORD 'EM UP!
      </h1>
          <div style="">
            <input type="hidden" value="1" id="round">
            <div class="" id="wordHolder" style="">
          </div>
          </div>
          <div class="mt-5">
           <button type="button" class="btn btn-primary" onClick="submitWord()" style="background-color: #D87CAC; border-color: #D87CAC; color: #004F2D; font-weight: bold; ">&nbsp;SUBMIT&nbsp;</button>
          </div>
      </main>
      <footer id="footer">

      </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script type="text/javascript" src="js/json/sets.json"></script>
    <script type="text/javascript">

      //pull in the sets JSON and define variable
      const wordSets = sets;

      // define elements to reference
      const wordHolderDiv = document.getElementById('wordHolder');
      const letterDivs = document.querySelectorAll('.guessedLetter');

      // find the word set for the day
      const todaySet = wordSets[0];

      // define the current date to use in loop of today's set
      const today = getCurrentDate(new Date());

      //define the word being pulled in
      //const firstWord = todaySet.first.replace(/\s/g, '');
      //const secondWord = todaySet.second.replace(/\s/g, '');
      //const thirdWord = todaySet.third.replace(/\s/g, '');

      let round = 1; 

      function focusOnNextSib(callback) {
        const letterRegex = /^[a-z]+$/i;
        let active = document.activeElement;
        let sibling = document.activeElement.nextElementSibling;
        let activeValue = active.value;
        if(letterRegex.test(activeValue)) {
          sibling.focus();
        }
      }

      function getCurrentDate(todayDate) {
        let month = todayDate.getMonth() + 1;
        let dateToReturn = todayDate.getFullYear() + '-' + month + '-' + todayDate.getDate()
        return dateToReturn
      }

      function generateBoxes(word, clue, lettersToShow) {
        let lettersShow = (lettersToShow ? lettersToShow : []);

        let wordsHTML = '';

        for (let w = 0; w < word.length; w++) {
          if (w == 0) {
            wordsHTML += '<input type="hidden" id="word" name="word" value="' + word + '"><br>'
          }
  
         let letter = (lettersShow.indexOf(word.charAt(w)) >= 0 ? word.charAt(w) : "");
         let borderColor = (letter.length > 0 ? "border-success text-bg-success" : "border-black");
         let readOnly = (letter.length > 0 ? "readonly" : "");
         wordsHTML += '<input id="letter' + w + '" value="' + letter + '" class="guessedLetter mb-2 text-center border border-3 ' + borderColor + '" style="width: 45px; height: 45px; text-transform: uppercase;" maxlength="1" ' + readOnly + ' onKeyup="focusOnNextSib()">&nbsp;'
        }

        wordsHTML += '<br><div id="clue" class="mb-2 text-center pt-5" style=""><b>Clue: </b>' + clue + '</div>'
        wordHolderDiv.innerHTML = wordsHTML;
      }

      function submitWord() {
        let lettersToShow = [];
        let guessedLetters = document.getElementsByClassName('guessedLetter');
        let currentWord = document.getElementById('word').value;
          for (let l = 0; l < guessedLetters.length; l++) {
            let guessedLetter = guessedLetters[l].value.toUpperCase();
            let realLetter = currentWord.charAt(l);
            if (guessedLetter == realLetter) {
              lettersToShow.push(realLetter)
            }
          }
          getWord(lettersToShow);
      }

      function getWord(lettersToShow) {
          let roundDiv = document.getElementById('round');
          let round = roundDiv.value;
          let todaysSet = wordSets.filter((set) => set.date == today);
          let lookupSet = todaysSet[0].words;
          let word = lookupSet.filter((set) => set.order == round);
          if(word.length > 0) {
            let currWord = word[0].word.replace(/\s/g, '');
            let currClue = word[0].clue;
            generateBoxes(currWord, currClue, lettersToShow);
          round = parseInt(round) + 1;
          roundDiv.value = round;
          }
      }

      getWord();

    </script>
  </body>
</html>
