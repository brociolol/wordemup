<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TOP SECRET PROJECT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Josefin+Slab&family=Lilita+One&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <style>
      .keypad {
        border: 1px solid #8a858f;
        background-color: #ffffff;
        color: #091E05;
        font-weight: bold;
        text-align: center;
        padding: 8px;
      }
      .keypad:hover {
        border: 1px solid #8a858f;
      }
      .keypad:active {
        border: 1px solid #8a858f;
      }

      .success-guess {
        background-color: #004F2D;
        color: #fff;
        border: 1px solid #000;
        outline: none;
      }

      input:active {
        background-color: #F9B9C3
      }

      input:focus {
        background-color: #F9B9C3;
        outline: none;
      }

      @media only screen and (max-width: 600px) {
  .keypad {
    font-size: 16px;
    width: 30px;
  }
  .submit {
    width: 100px !important;
  }
}

    </style>
  </head>
  <body style="background-color: #EDF2F4">
    <div class="d-flex justify-content-center align-items-center" id="container" style="">
      <main class="d-flex justify-content-center align-items-center flex-column text-center p-2 mt-3" id="main" style="width: 100%; max-width: 900px; height: 90vh;">
        <h1 id="header" class="text-center" style="height: 50px; color: #004F2D; font-family: 'Lilita One', sans-serif;">
        WORD 'EM UP!
      </h1>
          <div id="gameContainer" style="height: 200px;">
            <div id="results"><i class="bi bi-circle result"></i>&nbsp;<i class="bi bi-circle result"></i>&nbsp;<i class="bi bi-circle result"></i></div>
            <input type="hidden" value="1" id="round">
            <div class="" id="wordHolder" style="">
          </div>
          </div>
          <div>
            <div class="mb-2">
              <button type="button" class="btn keypad" onClick="keypad('Q')">Q</button>
            <button type="button" class="btn keypad" onClick="keypad('W')">W</button>
            <button type="button" class="btn keypad" onClick="keypad('E')">E</button>
            <button type="button" class="btn keypad" onClick="keypad('R')">R</button>
            <button type="button" class="btn keypad" onClick="keypad('T')">T</button>
            <button type="button" class="btn keypad" onClick="keypad('Y')">Y</button>
            <button type="button" class="btn keypad" onClick="keypad('U')">U</button>
            <button type="button" class="btn keypad" onClick="keypad('I')">I</button>
            <button type="button" class="btn keypad" onClick="keypad('O')">O</button>
            <button type="button" class="btn keypad" onClick="keypad('P')">P</button>
            </div>
             <div class="mb-2">
            <button type="button" class="btn keypad" onClick="keypad('A')">A</button>
            <button type="button" class="btn keypad" onClick="keypad('S')">S</button>
            <button type="button" class="btn keypad" onClick="keypad('D')">D</button>
            <button type="button" class="btn keypad" onClick="keypad('F')">F</button>
            <button type="button" class="btn keypad" onClick="keypad('G')">G</button>
            <button type="button" class="btn keypad" onClick="keypad('H')">H</button>
            <button type="button" class="btn keypad" onClick="keypad('J')">J</button>
            <button type="button" class="btn keypad" onClick="keypad('K')">K</button>
            <button type="button" class="btn keypad" onClick="keypad('L')">L</button>
          </div>
             <div class="mb-2">
            <button type="button" class="btn keypad" onClick="keypad('Z')">Z</button>
            <button type="button" class="btn keypad" onClick="keypad('X')">X</button>
            <button type="button" class="btn keypad" onClick="keypad('C')">C</button>
            <button type="button" class="btn keypad" onClick="keypad('V')">V</button>
            <button type="button" class="btn keypad" onClick="keypad('B')">B</button>
            <button type="button" class="btn keypad" onClick="keypad('N')">N</button>
            <button type="button" class="btn keypad" onClick="keypad('M')">M</button>
          </div>
          <div class="mb-2">
            <button type="button" class="btn keypad" onClick="keypad('<')"><</button>
            <button type="button" class="btn keypad" onClick="keypad('>')">></button>
            <button type="button" class="btn keypad submit" onClick="submitWord()" style="background-color: #D87CAC;  font-weight: bold; ">&nbsp;SUBMIT&nbsp;</button>
            <button type="button" class="btn keypad" onClick="keypad('delete')"><b><i class="bi bi-backspace"></i></b></button>
          </div>
          </div>
      </main>
      <footer id="footer">

      </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script type="text/javascript" src="js/json/sets.json"></script>
    <script type="text/javascript">

      //pull in the sets JSON and define variable
      const wordSets = sets;

      // define elements to reference
      const wordHolderDiv = document.getElementById('wordHolder');
      const gameContainerDiv = document.getElementById('gameContainer');
      const letterDivs = document.querySelectorAll('.guessedLetter');
      const roundDiv = document.getElementById('round');

      // find the word set for the day
      const todaySet = wordSets[0];

      // define the current date to use in loop of today's set
      const today = getCurrentDate(new Date());

      // define letter regex
      const letterRegex = /^[a-z]+$/i;

      //define the word being pulled in
      //const firstWord = todaySet.first.replace(/\s/g, '');
      //const secondWord = todaySet.second.replace(/\s/g, '');
      //const thirdWord = todaySet.third.replace(/\s/g, '');

      let round = 1; 

      let lastFocus = '';
      let lastFocusDiv = '';

      let gameResults = [];

      function keypad(letter) {
        if (letterRegex.test(letter) && letter.length == 1) {
          lastFocusDiv.value = letter;
          focusOnNextSib();
        } else {
          if (letter == '>') {
             focusOnNextSib();
           } else if (letter == '<') {
            focusOnPrevSib();
           } else if (letter == 'delete' && lastFocusDiv.value.length > 0) {
            lastFocusDiv.value = '';
            lastFocusDiv.focus();
           } else if (letter == 'delete' && lastFocusDiv.value.length <= 0) {
            focusOnPrevSib();
           }
        }
      }

      function focusOnPrevSib() {

        let active = lastFocusDiv;
        let sibling = lastFocusDiv.previousElementSibling;
        if (sibling.className.indexOf("guessedLetter") >= 0) {
          sibling.focus();
        if (active.className.indexOf("success-guess") >= 0) {
          sibling.focus();
          focusOnNextSib();
        } else {
          let activeValue = active.value;
            if(letterRegex.test(activeValue)) {
              sibling.focus();
            }
        }
        } else {
          active.focus()
        } 
      }

      function focusOnNextSib() {

        let active = lastFocusDiv;
        let sibling = lastFocusDiv.nextElementSibling;
        console.log(sibling.className);
        if (sibling.className.indexOf("guessedLetter") >= 0) {
          sibling.focus();
        if (sibling.className.indexOf("success-guess") >= 0) {
          sibling.focus();
          focusOnNextSib();
        } else {
          let activeValue = active.value;
            if(letterRegex.test(activeValue)) {
              sibling.focus();
            }
        }
        } else {
          active.focus()
        } 
      }


      function getCurrentDate(todayDate) {
        let month = todayDate.getMonth() + 1;
        let dateToReturn = todayDate.getFullYear() + '-' + month + '-' + todayDate.getDate()
        return dateToReturn
      }

      function generateBoxes(word, clue, lettersToShow) {
        let lettersShow = (lettersToShow ? lettersToShow : []);

        let wordsHTML = '';

        for (let w = 0; w < word.length; w++) {
          if (w == 0) {
            wordsHTML += '<input type="hidden" id="word" name="word" value="' + word + '"><br>'
          }
  
         let letter = "";
         let borderColor = (letter.length > 0 ? "border-black" : "border-black");
         wordsHTML += '<input id="letter' + w + '" value="' + letter + '" class="guessedLetter mb-2 text-center border border-3 ' + borderColor + '" style="width: 45px; height: 45px; text-transform: uppercase;" maxlength="1" readOnly onFocus="logFocus(\'letter' + w + '\')">&nbsp;'
        }

        wordsHTML += '<div id="clue" class="mb-2 text-center pt-3" style=""><b>Clue: </b>' + clue + '</div>'
        wordHolderDiv.innerHTML = wordsHTML;

        let lettersToHighlight = Array.from(new Set(lettersToShow));

        let keys = document.querySelectorAll('.keypad');
        for (let k = 0; k < keys.length; k++) {
          if (lettersToHighlight.indexOf(keys[k].innerHTML) >= 0) {
            keys[k].className = keys[k].className + ' success-guess';
          }
        }

        let boxToFocusOn = document.getElementById('letter0');
        boxToFocusOn.focus();
      }

      function logFocus(id) {
       lastFocus = id;
       lastFocusDiv = document.getElementById(lastFocus);
      }

      function submitWord() {
        let lettersToShow = [];
        let guessedLetterArray = [];
        let roundResult = 'success';
        let guessedLetters = document.getElementsByClassName('guessedLetter');
        let currentWord = document.getElementById('word').value;
          for (let l = 0; l < guessedLetters.length; l++) {
            let guessedLetter = guessedLetters[l].value.toUpperCase();
            guessedLetterArray.push(guessedLetter);
            let realLetter = currentWord.charAt(l);
            if (guessedLetter == realLetter) {
              lettersToShow.push(realLetter)
            }
          }
          let guessedWord = guessedLetterArray.join("");
          if(guessedWord != currentWord) {
            lettersToShow = [];
            roundResult = 'fail';
          }
          logResult(roundResult, lettersToShow);
      }

      function logResult(roundResult, lettersToShow) {
         let resultDivs = document.querySelectorAll('.result');
         roundToUse = parseInt(roundDiv.value) - 2;
          if (roundResult == 'success') {
            resultDivs[roundToUse].className = 'bi bi-check-circle-fill result';
            gameResults.push(roundResult);
          } else {
            resultDivs[roundToUse].className = 'bi bi-x-circle-fill result';
          }
          getWord(lettersToShow);
      }

      function getWord(lettersToShow) {
          round = roundDiv.value;
          if (round <= 3) {
let todaysSet = wordSets.filter((set) => set.date == today);
          let lookupSet = todaysSet[0].words;
          let word = lookupSet.filter((set) => set.order == round);
          if(word.length > 0) {
            let currWord = word[0].word.replace(/\s/g, '');
            let currClue = word[0].clue;
            generateBoxes(currWord, currClue, lettersToShow);
          round = parseInt(round) + 1;
          roundDiv.value = round;
          }
          
          } else {
            finishGame();
          }
      }

      function finishGame() {
        if (gameResults.length == 1) {
        alert('Phew!');
      } else if (gameResults.length == 2) {
        alert('Nice!');
      } else if (gameResults.length == 3) {
        alert('Woot woot!!');
      } else {
        alert('Better luck next time!');
      }
    }

      getWord();

    </script>
  </body>
</html>
